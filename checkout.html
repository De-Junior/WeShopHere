<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - WeShopOnline</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Reset & Base */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: #f4f6f8;
      color: #1f2937;
      line-height: 1.5;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    button {
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    /* Header */
    header {
      background: #1f2937;
      color: #fff;
      padding: 14px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo a {
      font-size: 28px;
      font-weight: 700;
      color: #38bdf8;
    }

    .back-to-shop {
      color: #fff;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .back-to-shop:hover {
      text-decoration: underline;
    }

    /* Checkout Container */
    .checkout-container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 16px;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 40px;
    }

    @media (max-width: 1024px) {
      .checkout-container {
        grid-template-columns: 1fr;
      }
    }

    /* Checkout Steps */
    .checkout-steps {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 40px;
      position: relative;
    }

    .checkout-steps:before {
      content: '';
      position: absolute;
      top: 16px;
      left: 0;
      right: 0;
      height: 2px;
      background: #e5e7eb;
      z-index: 1;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    .step-number {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: #e5e7eb;
      color: #6b7280;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-bottom: 8px;
      border: 2px solid #fff;
    }

    .step.active .step-number {
      background: #2563eb;
      color: #fff;
    }

    .step.completed .step-number {
      background: #10b981;
      color: #fff;
    }

    .step-label {
      font-size: 13px;
      color: #6b7280;
      font-weight: 500;
    }

    .step.active .step-label {
      color: #2563eb;
      font-weight: 600;
    }

    /* Forms */
    .checkout-section {
      background: #fff;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 24px;
      color: #1f2937;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      font-size: 18px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #374151;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-top: 20px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-top: 2px;
    }

    .checkbox-group label {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.4;
    }

    .checkbox-group a {
      color: #2563eb;
      text-decoration: underline;
    }

    /* Payment Methods */
    .payment-methods {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .payment-method {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .payment-method:hover {
      border-color: #2563eb;
      background: #f8fafc;
    }

    .payment-method.selected {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .payment-method input[type="radio"] {
      width: 18px;
      height: 18px;
    }

    .payment-method-icon {
      font-size: 24px;
    }

    .payment-method-info h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #1f2937;
    }

    .payment-method-info p {
      font-size: 13px;
      color: #6b7280;
    }

    /* Order Summary */
    .order-summary {
      background: #fff;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: sticky;
      top: 40px;
    }

    .order-summary-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 24px;
      color: #1f2937;
    }

    .order-items {
      margin-bottom: 24px;
      max-height: 300px;
      overflow-y: auto;
    }

    .order-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .order-item:last-child {
      border-bottom: none;
    }

    .order-item-image {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      overflow: hidden;
      background: #f9fafb;
    }

    .order-item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .order-item-details {
      flex: 1;
    }

    .order-item-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #1f2937;
    }

    .order-item-price {
      font-size: 14px;
      font-weight: 700;
      color: #16a34a;
    }

    .order-item-quantity {
      font-size: 14px;
      color: #6b7280;
    }

    /* Price Breakdown */
    .price-breakdown {
      margin: 24px 0;
      padding: 20px 0;
      border-top: 1px solid #e5e7eb;
      border-bottom: 1px solid #e5e7eb;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .price-row:last-child {
      margin-bottom: 0;
    }

    .price-row.total {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
    }

    .price-row.discount {
      color: #10b981;
    }

    /* Promo Code */
    .promo-code {
      margin-bottom: 24px;
    }

    .promo-code-input {
      display: flex;
      gap: 12px;
    }

    .promo-code-input input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
    }

    .promo-code-input button {
      padding: 12px 20px;
      background: #f1f5f9;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-weight: 600;
      color: #1f2937;
      white-space: nowrap;
    }

    .promo-code-input button:hover {
      background: #e2e8f0;
    }

    /* Secure Checkout */
    .secure-checkout {
      text-align: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }

    .secure-checkout p {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .secure-icons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
    }

    .secure-icon {
      font-size: 20px;
      color: #6b7280;
    }

    /* Place Order Button */
    .place-order-btn {
      width: 100%;
      padding: 18px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      margin-top: 24px;
      transition: all 0.2s ease;
    }

    .place-order-btn:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }

    .place-order-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }

    /* Error Messages */
    .error-message {
      color: #dc2626;
      font-size: 13px;
      margin-top: 6px;
      display: none;
    }

    .has-error input,
    .has-error select,
    .has-error textarea {
      border-color: #dc2626 !important;
    }

    .has-error .error-message {
      display: block;
    }

    /* Success Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex !important;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      padding: 40px;
      text-align: center;
      animation: modalFadeIn 0.3s ease;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-icon {
      font-size: 64px;
      color: #10b981;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 12px;
    }

    .modal-message {
      font-size: 16px;
      color: #6b7280;
      margin-bottom: 30px;
      line-height: 1.5;
    }

    .order-details {
      background: #f9fafb;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      text-align: left;
    }

    .order-details p {
      margin: 8px 0;
      font-size: 14px;
      color: #4b5563;
    }

    .order-details strong {
      color: #1f2937;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .modal-btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: #f1f5f9;
      color: #1f2937;
      border: 1px solid #d1d5db;
    }

    .btn-secondary:hover {
      background: #e2e8f0;
    }

    /* Loading State */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>

<header>
  <div class="logo"><a href="index.html">WeShopOnline</a></div>
  <a href="index.html" class="back-to-shop">
    ‚Üê Back to Shop
  </a>
</header>

<main class="checkout-container">
  <!-- Checkout Form -->
  <div class="checkout-form">
    <!-- Progress Steps -->
    <div class="checkout-steps">
      <div class="step completed">
        <div class="step-number">1</div>
        <div class="step-label">Cart</div>
      </div>
      <div class="step active">
        <div class="step-number">2</div>
        <div class="step-label">Information</div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-label">Payment</div>
      </div>
      <div class="step">
        <div class="step-number">4</div>
        <div class="step-label">Confirmation</div>
      </div>
    </div>

    <!-- Contact Information -->
    <div class="checkout-section">
      <div class="section-title">
        <i>üì±</i> Contact Information
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" placeholder="your@email.com" required>
          <div class="error-message">Please enter a valid email address</div>
        </div>
        <div class="form-group">
          <label for="phone">Phone Number *</label>
          <input type="tel" id="phone" placeholder="+27 12 345 6789" required>
          <div class="error-message">Please enter a valid phone number</div>
        </div>
      </div>
    </div>

    <!-- Shipping Address -->
    <div class="checkout-section">
      <div class="section-title">
        <i>üìç</i> Shipping Address
      </div>
      <div class="form-grid">
        <div class="form-group">
          <label for="firstName">First Name *</label>
          <input type="text" id="firstName" placeholder="John" required>
          <div class="error-message">Please enter your first name</div>
        </div>
        <div class="form-group">
          <label for="lastName">Last Name *</label>
          <input type="text" id="lastName" placeholder="Doe" required>
          <div class="error-message">Please enter your last name</div>
        </div>
        <div class="form-group full-width">
          <label for="address">Address *</label>
          <input type="text" id="address" placeholder="123 Main Street" required>
          <div class="error-message">Please enter your address</div>
        </div>
        <div class="form-group">
          <label for="city">City *</label>
          <input type="text" id="city" placeholder="Cape Town" required>
          <div class="error-message">Please enter your city</div>
        </div>
        <div class="form-group">
          <label for="province">Province *</label>
          <select id="province" required>
            <option value="">Select Province</option>
            <option value="EC">Eastern Cape</option>
            <option value="FS">Free State</option>
            <option value="GP">Gauteng</option>
            <option value="KZN">KwaZulu-Natal</option>
            <option value="LP">Limpopo</option>
            <option value="MP">Mpumalanga</option>
            <option value="NC">Northern Cape</option>
            <option value="NW">North West</option>
            <option value="WC">Western Cape</option>
          </select>
          <div class="error-message">Please select a province</div>
        </div>
        <div class="form-group">
          <label for="postalCode">Postal Code *</label>
          <input type="text" id="postalCode" placeholder="8001" required>
          <div class="error-message">Please enter a valid postal code</div>
        </div>
        <div class="form-group full-width">
          <label for="instructions">Delivery Instructions (Optional)</label>
          <textarea id="instructions" rows="3" placeholder="Any special delivery instructions..."></textarea>
        </div>
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="saveAddress">
        <label for="saveAddress">Save this address for future orders</label>
      </div>
    </div>

    <!-- Payment Method -->
    <div class="checkout-section">
      <div class="section-title">
        <i>üí≥</i> Payment Method
      </div>
      <div class="payment-methods">
        <label class="payment-method selected" for="card">
          <input type="radio" id="card" name="payment" value="card" checked>
          <div class="payment-method-icon">üí≥</div>
          <div class="payment-method-info">
            <h4>Credit/Debit Card</h4>
            <p>Pay with Visa, MasterCard, or American Express</p>
          </div>
        </label>
        
        <label class="payment-method" for="payfast">
          <input type="radio" id="payfast" name="payment" value="payfast">
          <div class="payment-method-icon">‚ö°</div>
          <div class="payment-method-info">
            <h4>PayFast</h4>
            <p>Secure online payments via PayFast</p>
          </div>
        </label>
        
        <label class="payment-method" for="eft">
          <input type="radio" id="eft" name="payment" value="eft">
          <div class="payment-method-icon">üè¶</div>
          <div class="payment-method-info">
            <h4>Bank Transfer (EFT)</h4>
            <p>Make payment directly from your bank account</p>
          </div>
        </label>
        
        <label class="payment-method" for="cash">
          <input type="radio" id="cash" name="payment" value="cash">
          <div class="payment-method-icon">üíµ</div>
          <div class="payment-method-info">
            <h4>Cash on Delivery</h4>
            <p>Pay when you receive your order</p>
          </div>
        </label>
      </div>

      <!-- Card Details (only show when card is selected) -->
      <div id="cardDetails" class="form-grid" style="margin-top: 20px; display: grid;">
        <div class="form-group full-width">
          <label for="cardNumber">Card Number</label>
          <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
          <div class="error-message">Please enter a valid card number</div>
        </div>
        <div class="form-group">
          <label for="cardName">Name on Card</label>
          <input type="text" id="cardName" placeholder="John Doe">
          <div class="error-message">Please enter the name on card</div>
        </div>
        <div class="form-group">
          <label for="expiry">Expiry Date</label>
          <input type="text" id="expiry" placeholder="MM/YY">
          <div class="error-message">Please enter expiry date</div>
        </div>
        <div class="form-group">
          <label for="cvv">CVV</label>
          <input type="text" id="cvv" placeholder="123" maxlength="3">
          <div class="error-message">Please enter CVV</div>
        </div>
      </div>
    </div>

    <!-- Terms and Conditions -->
    <div class="checkout-section">
      <div class="checkbox-group">
        <input type="checkbox" id="terms" required>
        <label for="terms">
          I agree to the <a href="#">Terms & Conditions</a> and <a href="#">Privacy Policy</a>. *
        </label>
      </div>
      <div class="error-message" id="termsError" style="margin-top: 10px;">You must agree to the terms and conditions</div>
    </div>
  </div>

  <!-- Order Summary -->
  <div class="order-summary">
    <h2 class="order-summary-title">Order Summary</h2>
    
    <!-- Order Items -->
    <div class="order-items" id="orderItems">
      <!-- Items will be populated by JavaScript -->
    </div>

    <!-- Price Breakdown -->
    <div class="price-breakdown">
      <div class="price-row">
        <span>Subtotal</span>
        <span id="subtotal">R0.00</span>
      </div>
      <div class="price-row">
        <span>Shipping</span>
        <span id="shipping">R99.00</span>
      </div>
      <div class="price-row discount">
        <span>Discount (10%)</span>
        <span id="discount">-R0.00</span>
      </div>
      <div class="price-row total">
        <span>Total</span>
        <span id="total">R0.00</span>
      </div>
    </div>

    <!-- Promo Code -->
    <div class="promo-code">
      <div class="promo-code-input">
        <input type="text" id="promoCode" placeholder="Promo Code">
        <button onclick="applyPromoCode()">Apply</button>
      </div>
      <div id="promoMessage" style="font-size: 13px; margin-top: 8px;"></div>
    </div>

    <!-- Place Order Button -->
    <button class="place-order-btn" onclick="proceedToPayment()">
      <span id="btnText">Proceed to Payment</span>
      <span id="btnLoading" class="loading" style="display: none;"></span>
    </button>

    <!-- Secure Checkout -->
    <div class="secure-checkout">
      <p>üîí Secure Checkout ‚Ä¢ 256-bit SSL Encryption</p>
      <div class="secure-icons">
        <span class="secure-icon">üîí</span>
        <span class="secure-icon">üõ°Ô∏è</span>
        <span class="secure-icon">‚úì</span>
      </div>
    </div>
  </div>
</main>

<!-- Success Modal -->
<div class="modal-overlay" id="successModal">
  <div class="modal-content">
    <div class="modal-icon">üéâ</div>
    <h2 class="modal-title">Order Successful!</h2>
    <p class="modal-message">Thank you for your purchase. Your order has been placed successfully.</p>
    
    <div class="order-details">
      <p><strong>Order Number:</strong> <span id="orderNumber">#ORD-123456</span></p>
      <p><strong>Total Amount:</strong> <span id="orderTotal">R0.00</span></p>
      <p><strong>Estimated Delivery:</strong> 5-7 working days</p>
      <p><strong>Payment Method:</strong> <span id="orderPayment">Credit Card</span></p>
    </div>
    
    <div class="modal-actions">
      <button class="modal-btn btn-secondary" onclick="continueShopping()">Continue Shopping</button>
      <button class="modal-btn btn-primary" onclick="trackOrder()">Track Order</button>
    </div>
  </div>
</div>

<script>
  // Cart data from localStorage or default data
  let cartItems = JSON.parse(localStorage.getItem('cart')) || [
    { name: "Power Bank 20000mAh", price: 699, quantity: 1, image: "https://www.geewiz.co.za/247298-large_default/philips-2-port-20000mah-power-bank.jpg" },
    { name: "Gaming Mouse", price: 499, quantity: 2, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSX3YvNGeMRX9_7-ohSXJP_NvsHffPhRocMOg&s" },
    { name: "Wireless Headphones", price: 899, quantity: 1, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR9cYWSaBNIhOPF2gguIun1olGtIYrHAlOO7w&s" }
  ];

  let subtotal = 0;
  let shipping = 99;
  let discount = 0;
  let promoApplied = false;
  let orderNumber = generateOrderNumber();

  // Initialize page
  document.addEventListener('DOMContentLoaded', () => {
    renderOrderItems();
    updateTotals();
    setupEventListeners();
  });

  // Render order items
  function renderOrderItems() {
    const orderItems = document.getElementById('orderItems');
    orderItems.innerHTML = '';
    
    cartItems.forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'order-item';
      itemElement.innerHTML = `
        <div class="order-item-image">
          <img src="${item.image}" alt="${item.name}">
        </div>
        <div class="order-item-details">
          <div class="order-item-name">${item.name}</div>
          <div class="order-item-price">R${item.price.toFixed(2)}</div>
          <div class="order-item-quantity">Qty: ${item.quantity}</div>
        </div>
      `;
      orderItems.appendChild(itemElement);
      
      subtotal += item.price * item.quantity;
    });
  }

  // Update totals
  function updateTotals() {
    discount = promoApplied ? subtotal * 0.1 : 0;
    const total = subtotal + shipping - discount;
    
    document.getElementById('subtotal').textContent = `R${subtotal.toFixed(2)}`;
    document.getElementById('discount').textContent = `-R${discount.toFixed(2)}`;
    document.getElementById('total').textContent = `R${total.toFixed(2)}`;
    document.getElementById('orderTotal').textContent = `R${total.toFixed(2)}`;
  }

  // Setup event listeners
  function setupEventListeners() {
    // Payment method selection
    const paymentMethods = document.querySelectorAll('.payment-method');
    paymentMethods.forEach(method => {
      method.addEventListener('click', () => {
        paymentMethods.forEach(m => m.classList.remove('selected'));
        method.classList.add('selected');
        
        // Show/hide card details
        const cardDetails = document.getElementById('cardDetails');
        if (method.querySelector('input').value === 'card') {
          cardDetails.style.display = 'grid';
        } else {
          cardDetails.style.display = 'none';
          // Clear any errors from card fields when hiding them
          clearCardErrors();
        }
      });
    });

    // Form validation on blur
    const inputs = document.querySelectorAll('input[required], select[required]');
    inputs.forEach(input => {
      input.addEventListener('blur', () => validateSingleField(input));
      input.addEventListener('input', () => clearSingleError(input));
    });

    // Card number formatting
    const cardNumber = document.getElementById('cardNumber');
    if (cardNumber) {
      cardNumber.addEventListener('input', formatCardNumber);
    }

    // Expiry date formatting
    const expiry = document.getElementById('expiry');
    if (expiry) {
      expiry.addEventListener('input', formatExpiryDate);
    }
  }

  // Format card number
  function formatCardNumber(e) {
    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
    let formatted = '';
    
    for (let i = 0; i < value.length; i++) {
      if (i > 0 && i % 4 === 0) {
        formatted += ' ';
      }
      formatted += value[i];
    }
    
    e.target.value = formatted.substring(0, 19);
  }

  // Format expiry date
  function formatExpiryDate(e) {
    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
    
    if (value.length >= 2) {
      e.target.value = value.substring(0, 2) + '/' + value.substring(2, 4);
    } else {
      e.target.value = value;
    }
  }

  // Validate single field
  function validateSingleField(field) {
    const value = field.value.trim();
    const formGroup = field.closest('.form-group');
    
    if (!formGroup) return true;
    
    let isValid = true;
    let errorMessage = '';
    
    // Clear previous error
    formGroup.classList.remove('has-error');
    
    // Check if field is empty
    if (!value && field.hasAttribute('required')) {
      isValid = false;
      errorMessage = 'This field is required';
    } else if (value) {
      // Specific validations
      switch (field.id) {
        case 'email':
          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
            isValid = false;
            errorMessage = 'Please enter a valid email address';
          }
          break;
          
        case 'phone':
          if (!/^[\d\s\+\-\(\)]{10,}$/.test(value)) {
            isValid = false;
            errorMessage = 'Please enter a valid phone number';
          }
          break;
          
        case 'postalCode':
          if (!/^\d{4}$/.test(value)) {
            isValid = false;
            errorMessage = 'Please enter a valid postal code';
          }
          break;
          
        case 'cardNumber':
          if (value.replace(/\s/g, '').length < 16) {
            isValid = false;
            errorMessage = 'Please enter a valid card number';
          }
          break;
          
        case 'expiry':
          if (!/^\d{2}\/\d{2}$/.test(value)) {
            isValid = false;
            errorMessage = 'Please enter expiry in MM/YY format';
          }
          break;
          
        case 'cvv':
          if (value.length !== 3 || !/^\d+$/.test(value)) {
            isValid = false;
            errorMessage = 'Please enter a valid CVV';
          }
          break;
      }
    }
    
    if (!isValid) {
      formGroup.classList.add('has-error');
      const errorElement = formGroup.querySelector('.error-message');
      if (errorElement) {
        errorElement.textContent = errorMessage;
      }
    }
    
    return isValid;
  }

  // Clear single error
  function clearSingleError(field) {
    const formGroup = field.closest('.form-group');
    if (formGroup) {
      formGroup.classList.remove('has-error');
    }
  }

  // Clear card errors
  function clearCardErrors() {
    const cardFields = ['cardNumber', 'cardName', 'expiry', 'cvv'];
    cardFields.forEach(fieldId => {
      const field = document.getElementById(fieldId);
      if (field) {
        const formGroup = field.closest('.form-group');
        if (formGroup) {
          formGroup.classList.remove('has-error');
        }
      }
    });
  }

  // Apply promo code
  function applyPromoCode() {
    const promoInput = document.getElementById('promoCode');
    const promoMessage = document.getElementById('promoMessage');
    const code = promoInput.value.trim().toUpperCase();
    
    if (code === 'WELCOME10') {
      promoApplied = true;
      promoMessage.textContent = 'üéâ 10% discount applied!';
      promoMessage.style.color = '#10b981';
      updateTotals();
    } else if (code) {
      promoMessage.textContent = '‚ùå Invalid promo code';
      promoMessage.style.color = '#dc2626';
    } else {
      promoMessage.textContent = 'Please enter a promo code';
      promoMessage.style.color = '#6b7280';
    }
  }

  // SIMPLIFIED Validate form - FIXED VERSION
  function validateForm() {
    let isValid = true;
    
    // Get selected payment method
    const selectedPayment = document.querySelector('input[name="payment"]:checked').value;
    
    // Validate all required fields (excluding card fields if not card payment)
    const requiredFields = document.querySelectorAll('input[required], select[required]');
    
    requiredFields.forEach(field => {
      // Skip card fields if not paying by card
      if (selectedPayment !== 'card') {
        const isCardField = field.id === 'cardNumber' || 
                           field.id === 'cardName' || 
                           field.id === 'expiry' || 
                           field.id === 'cvv';
        if (isCardField) {
          return; // Skip this field
        }
      }
      
      // Validate the field
      if (!validateSingleField(field)) {
        isValid = false;
      }
    });
    
    // If paying by card, validate card fields
    if (selectedPayment === 'card') {
      const cardFields = [
        {id: 'cardNumber', validate: (v) => v.replace(/\s/g, '').length >= 16, msg: 'Please enter a valid card number'},
        {id: 'cardName', validate: (v) => v.trim().length > 0, msg: 'Please enter name on card'},
        {id: 'expiry', validate: (v) => /^\d{2}\/\d{2}$/.test(v), msg: 'Please enter expiry in MM/YY format'},
        {id: 'cvv', validate: (v) => v.length === 3 && /^\d+$/.test(v), msg: 'Please enter a valid CVV'}
      ];
      
      cardFields.forEach(cardField => {
        const field = document.getElementById(cardField.id);
        const value = field ? field.value.trim() : '';
        const formGroup = field ? field.closest('.form-group') : null;
        
        if (formGroup) {
          formGroup.classList.remove('has-error');
          
          if (!cardField.validate(value)) {
            formGroup.classList.add('has-error');
            const errorElement = formGroup.querySelector('.error-message');
            if (errorElement) {
              errorElement.textContent = cardField.msg;
            }
            isValid = false;
          }
        }
      });
    }
    
    // Validate terms checkbox
    const termsCheckbox = document.getElementById('terms');
    const termsError = document.getElementById('termsError');
    if (!termsCheckbox.checked) {
      termsError.style.display = 'block';
      isValid = false;
    } else {
      termsError.style.display = 'none';
    }
    
    return isValid;
  }

  // Proceed to payment - SIMPLIFIED VERSION
  function proceedToPayment() {
    console.log('Proceed to payment clicked'); // Debug log
    
    if (!validateForm()) {
      console.log('Form validation failed'); // Debug log
      alert('Please fill in all required fields correctly.');
      return;
    }
    
    console.log('Form validation passed'); // Debug log
    
    // Show loading state
    const btnText = document.getElementById('btnText');
    const btnLoading = document.getElementById('btnLoading');
    const placeOrderBtn = document.querySelector('.place-order-btn');
    
    btnText.textContent = 'Processing...';
    btnLoading.style.display = 'inline-block';
    placeOrderBtn.disabled = true;
    
    // Simulate processing delay
    setTimeout(() => {
      // Save form data to localStorage
      const formData = {
        contact: {
          email: document.getElementById('email').value,
          phone: document.getElementById('phone').value
        },
        shipping: {
          firstName: document.getElementById('firstName').value,
          lastName: document.getElementById('lastName').value,
          address: document.getElementById('address').value,
          city: document.getElementById('city').value,
          province: document.getElementById('province').value,
          postalCode: document.getElementById('postalCode').value,
          instructions: document.getElementById('instructions').value
        },
        paymentMethod: document.querySelector('input[name="payment"]:checked').value
      };
      
      console.log('Saving form data:', formData); // Debug log
      localStorage.setItem('checkoutData', JSON.stringify(formData));
      
      console.log('Redirecting to payment.html...'); // Debug log
      window.location.href = 'payment.html';
    }, 1000);
  }

  // Generate order number
  function generateOrderNumber() {
    return '#ORD-' + Math.floor(100000 + Math.random() * 900000);
  }

  // Continue shopping
  function continueShopping() {
    window.location.href = 'index.html';
  }

  // Track order
  function trackOrder() {
    alert(`Track your order using order number: ${orderNumber}`);
    window.location.href = 'index.html';
  }

  // Close modal on ESC key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      document.getElementById('successModal').classList.remove('active');
      document.body.classList.remove('modal-open');
    }
  });

  // Close modal when clicking outside
  document.getElementById('successModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('successModal')) {
      document.getElementById('successModal').classList.remove('active');
      document.body.classList.remove('modal-open');
    }
  });
</script>

</body>
</html>