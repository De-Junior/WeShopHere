<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment - WeShopOnline</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Reset & Base */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: #f4f6f8;
      color: #1f2937;
      line-height: 1.5;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    button {
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    /* Header */
    header {
      background: #1f2937;
      color: #fff;
      padding: 14px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo a {
      font-size: 28px;
      font-weight: 700;
      color: #38bdf8;
    }

    .header-actions {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .back-to-shop {
      color: #fff;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .back-to-shop:hover {
      text-decoration: underline;
    }

    /* Checkout Progress */
    .checkout-progress {
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 16px;
    }

    .progress-steps {
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
    }

    .progress-steps:before {
      content: '';
      position: absolute;
      top: 16px;
      left: 0;
      right: 0;
      height: 2px;
      background: #e5e7eb;
      z-index: 1;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
      text-align: center;
      width: 120px;
    }

    .step-number {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: #e5e7eb;
      color: #6b7280;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-bottom: 8px;
      border: 2px solid #fff;
    }

    .step.completed .step-number {
      background: #10b981;
      color: #fff;
    }

    .step.active .step-number {
      background: #2563eb;
      color: #fff;
    }

    .step-label {
      font-size: 13px;
      color: #6b7280;
      font-weight: 500;
    }

    .step.active .step-label {
      color: #2563eb;
      font-weight: 600;
    }

    /* Payment Container */
    .payment-container {
      max-width: 1200px;
      margin: 0 auto 60px;
      padding: 0 16px;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 40px;
    }

    @media (max-width: 1024px) {
      .payment-container {
        grid-template-columns: 1fr;
      }
    }

    /* Payment Methods */
    .payment-section {
      background: #fff;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 24px;
      color: #1f2937;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      font-size: 18px;
    }

    .payment-methods {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .payment-method {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .payment-method:hover {
      border-color: #2563eb;
      background: #f8fafc;
    }

    .payment-method.selected {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .payment-method input[type="radio"] {
      width: 18px;
      height: 18px;
    }

    .payment-icon {
      font-size: 24px;
    }

    .payment-info {
      flex: 1;
    }

    .payment-info h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #1f2937;
    }

    .payment-info p {
      font-size: 13px;
      color: #6b7280;
    }

    /* Card Details */
    .card-details {
      margin-top: 24px;
      padding: 24px;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #374151;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s ease;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .card-logos {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .card-logo {
      font-size: 24px;
      color: #6b7280;
    }

    /* Bank Transfer Details */
    .bank-details {
      margin-top: 24px;
      padding: 24px;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      display: none;
    }

    .bank-info {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      border: 1px solid #e5e7eb;
    }

    .bank-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .bank-row:last-child {
      border-bottom: none;
    }

    .bank-label {
      font-size: 14px;
      color: #6b7280;
      font-weight: 500;
    }

    .bank-value {
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
    }

    .copy-btn {
      background: #f1f5f9;
      border: 1px solid #d1d5db;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      color: #1f2937;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .copy-btn:hover {
      background: #e2e8f0;
    }

    .copy-btn.copied {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }

    /* Order Summary */
    .order-summary {
      background: #fff;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: sticky;
      top: 40px;
    }

    .order-summary-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 24px;
      color: #1f2937;
    }

    .order-items {
      margin-bottom: 24px;
      max-height: 200px;
      overflow-y: auto;
    }

    .order-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .order-item:last-child {
      border-bottom: none;
    }

    .order-item-image {
      width: 50px;
      height: 50px;
      border-radius: 6px;
      overflow: hidden;
      background: #f9fafb;
    }

    .order-item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .order-item-details {
      flex: 1;
    }

    .order-item-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
      color: #1f2937;
    }

    .order-item-price {
      font-size: 14px;
      font-weight: 700;
      color: #16a34a;
    }

    .order-item-quantity {
      font-size: 12px;
      color: #6b7280;
    }

    /* Price Breakdown */
    .price-breakdown {
      margin: 24px 0;
      padding: 20px 0;
      border-top: 1px solid #e5e7eb;
      border-bottom: 1px solid #e5e7eb;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .price-row:last-child {
      margin-bottom: 0;
    }

    .price-row.total {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
    }

    .price-row.discount {
      color: #10b981;
    }

    /* Delivery Information */
    .delivery-info-section {
      background: #f9fafb;
      border-radius: 8px;
      padding: 20px;
      margin-top: 24px;
      border: 1px solid #e5e7eb;
    }

    .delivery-info-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #1f2937;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .delivery-details {
      font-size: 14px;
      color: #4b5563;
    }

    .delivery-details p {
      margin: 8px 0;
    }

    .delivery-details strong {
      color: #1f2937;
    }

    /* Secure Checkout */
    .secure-checkout {
      text-align: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }

    .secure-checkout p {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .secure-icons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
    }

    .secure-icon {
      font-size: 20px;
      color: #6b7280;
    }

    /* Navigation Buttons */
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 40px;
      gap: 20px;
    }

    .btn {
      padding: 14px 32px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary {
      background: #f1f5f9;
      color: #1f2937;
      border: 1px solid #d1d5db;
    }

    .btn-secondary:hover {
      background: #e2e8f0;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }

    .btn-primary:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }

    /* Terms and Conditions */
    .terms-section {
      margin-top: 20px;
    }

    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-top: 2px;
    }

    .checkbox-group label {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.4;
    }

    .checkbox-group a {
      color: #2563eb;
      text-decoration: underline;
    }

    /* Error Messages */
    .error-message {
      color: #dc2626;
      font-size: 13px;
      margin-top: 6px;
      display: none;
    }

    .has-error input,
    .has-error select {
      border-color: #dc2626 !important;
    }

    .has-error .error-message {
      display: block;
    }

    /* Loading State */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Success Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex !important;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      padding: 40px;
      text-align: center;
      animation: modalFadeIn 0.3s ease;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-icon {
      font-size: 64px;
      color: #10b981;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 12px;
    }

    .modal-message {
      font-size: 16px;
      color: #6b7280;
      margin-bottom: 30px;
      line-height: 1.5;
    }

    .order-details {
      background: #f9fafb;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      text-align: left;
    }

    .order-details p {
      margin: 8px 0;
      font-size: 14px;
      color: #4b5563;
    }

    .order-details strong {
      color: #1f2937;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .modal-btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal-btn.btn-primary {
      background: #2563eb;
      color: white;
    }

    .modal-btn.btn-primary:hover {
      background: #1d4ed8;
    }

    .modal-btn.btn-secondary {
      background: #f1f5f9;
      color: #1f2937;
      border: 1px solid #d1d5db;
    }

    .modal-btn.btn-secondary:hover {
      background: #e2e8f0;
    }
  </style>
</head>

<body>

<header>
  <div class="logo"><a href="index.html">WeShopOnline</a></div>
  <div class="header-actions">
    <a href="information.html" class="back-to-shop">
      ‚Üê Edit Information
    </a>
    <a href="index.html" class="back-to-shop">
      üè™ Continue Shopping
    </a>
  </div>
</header>

<!-- Checkout Progress -->
<div class="checkout-progress">
  <div class="progress-steps">
    <div class="step completed">
      <div class="step-number">1</div>
      <div class="step-label">Cart</div>
    </div>
    <div class="step completed">
      <div class="step-number">2</div>
      <div class="step-label">Information</div>
    </div>
    <div class="step active">
      <div class="step-number">3</div>
      <div class="step-label">Payment</div>
    </div>
    <div class="step">
      <div class="step-number">4</div>
      <div class="step-label">Confirmation</div>
    </div>
  </div>
</div>

<div class="payment-container">
  <!-- Payment Methods -->
  <div class="payment-form">
    <!-- Payment Method Selection -->
    <div class="payment-section">
      <div class="section-title">
        <i>üí≥</i> Payment Method
      </div>
      <div class="payment-methods">
        <label class="payment-method selected" for="card">
          <input type="radio" id="card" name="payment" value="card" checked>
          <div class="payment-icon">üí≥</div>
          <div class="payment-info">
            <h4>Credit/Debit Card</h4>
            <p>Pay with Visa, MasterCard, or American Express</p>
          </div>
        </label>
        
        <label class="payment-method" for="payfast">
          <input type="radio" id="payfast" name="payment" value="payfast">
          <div class="payment-icon">‚ö°</div>
          <div class="payment-info">
            <h4>PayFast</h4>
            <p>Secure online payments via PayFast</p>
          </div>
        </label>
        
        <label class="payment-method" for="eft">
          <input type="radio" id="eft" name="payment" value="eft">
          <div class="payment-icon">üè¶</div>
          <div class="payment-info">
            <h4>Bank Transfer (EFT)</h4>
            <p>Make payment directly from your bank account</p>
          </div>
        </label>
        
        <label class="payment-method" for="cash">
          <input type="radio" id="cash" name="payment" value="cash">
          <div class="payment-icon">üíµ</div>
          <div class="payment-info">
            <h4>Cash on Delivery</h4>
            <p>Pay when you receive your order</p>
          </div>
        </label>
      </div>

      <!-- Card Details -->
      <div id="cardDetails" class="card-details">
        <div class="form-group full-width">
          <label for="cardNumber">Card Number *</label>
          <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
          <div class="card-logos">
            <span class="card-logo">üí≥</span>
            <span class="card-logo">üí≥</span>
            <span class="card-logo">üí≥</span>
          </div>
          <div class="error-message">Please enter a valid card number</div>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="cardName">Name on Card *</label>
            <input type="text" id="cardName" placeholder="John Doe">
            <div class="error-message">Please enter the name on card</div>
          </div>
          <div class="form-group">
            <label for="expiry">Expiry Date *</label>
            <input type="text" id="expiry" placeholder="MM/YY">
            <div class="error-message">Please enter expiry date</div>
          </div>
          <div class="form-group">
            <label for="cvv">CVV *</label>
            <input type="text" id="cvv" placeholder="123" maxlength="3">
            <div class="error-message">Please enter CVV</div>
          </div>
        </div>
      </div>

      <!-- Bank Transfer Details -->
      <div id="bankDetails" class="bank-details">
        <div class="bank-info">
          <div class="bank-row">
            <span class="bank-label">Bank Name:</span>
            <span class="bank-value">Standard Bank</span>
            <button class="copy-btn" onclick="copyToClipboard('Standard Bank')">Copy</button>
          </div>
          <div class="bank-row">
            <span class="bank-label">Account Name:</span>
            <span class="bank-value">WeShopOnline (Pty) Ltd</span>
            <button class="copy-btn" onclick="copyToClipboard('WeShopOnline (Pty) Ltd')">Copy</button>
          </div>
          <div class="bank-row">
            <span class="bank-label">Account Number:</span>
            <span class="bank-value">0123456789</span>
            <button class="copy-btn" onclick="copyToClipboard('0123456789')">Copy</button>
          </div>
          <div class="bank-row">
            <span class="bank-label">Branch Code:</span>
            <span class="bank-value">051001</span>
            <button class="copy-btn" onclick="copyToClipboard('051001')">Copy</button>
          </div>
          <div class="bank-row">
            <span class="bank-label">Reference:</span>
            <span class="bank-value" id="bankReference">ORD-123456</span>
            <button class="copy-btn" onclick="copyToClipboard(document.getElementById('bankReference').textContent)">Copy</button>
          </div>
        </div>
        <p style="margin-top: 16px; font-size: 13px; color: #6b7280;">
          Please use the reference number above when making your payment. Your order will be processed once payment is received.
        </p>
      </div>
    </div>

    <!-- Terms and Conditions -->
    <div class="payment-section terms-section">
      <div class="checkbox-group">
        <input type="checkbox" id="terms" required>
        <label for="terms">
          I agree to the <a href="terms.html">Terms & Conditions</a> and <a href="privacy.html">Privacy Policy</a>. I authorize WeShopOnline to charge my selected payment method for the total amount shown. *
        </label>
      </div>
      <div class="error-message" id="termsError" style="margin-top: 10px;">You must agree to the terms and conditions</div>
    </div>

    <!-- Navigation Buttons -->
    <div class="navigation-buttons">
      <button class="btn btn-secondary" onclick="goToInformation()">
        ‚Üê Back to Information
      </button>
      <button class="btn btn-primary" onclick="processPayment()" id="payButton">
        <span id="btnText">Complete Payment</span>
        <span id="btnLoading" class="loading" style="display: none;"></span>
      </button>
    </div>

    <!-- Secure Checkout -->
    <div class="secure-checkout">
      <p>üîí Secure Checkout ‚Ä¢ 256-bit SSL Encryption</p>
      <div class="secure-icons">
        <span class="secure-icon">üîí</span>
        <span class="secure-icon">üõ°Ô∏è</span>
        <span class="secure-icon">‚úì</span>
      </div>
    </div>
  </div>

  <!-- Order Summary -->
  <div class="order-summary">
    <h2 class="order-summary-title">Order Summary</h2>
    
    <!-- Order Items -->
    <div class="order-items" id="orderItems">
      <!-- Items populated by JavaScript -->
    </div>

    <!-- Price Breakdown -->
    <div class="price-breakdown">
      <div class="price-row">
        <span>Subtotal</span>
        <span id="subtotal">R0.00</span>
      </div>
      <div class="price-row">
        <span>Shipping</span>
        <span id="shipping">R99.00</span>
      </div>
      <div class="price-row discount">
        <span>Discount (10%)</span>
        <span id="discount">-R0.00</span>
      </div>
      <div class="price-row total">
        <span>Total</span>
        <span id="total">R0.00</span>
      </div>
    </div>

    <!-- Delivery Information -->
    <div class="delivery-info-section">
      <div class="delivery-info-title">
        <i>üìç</i> Delivery Information
      </div>
      <div class="delivery-details" id="deliveryDetails">
        <!-- Populated by JavaScript -->
      </div>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal-overlay" id="successModal">
  <div class="modal-content">
    <div class="modal-icon">üéâ</div>
    <h2 class="modal-title">Payment Successful!</h2>
    <p class="modal-message">Thank you for your purchase. Your order has been placed successfully.</p>
    
    <div class="order-details">
      <p><strong>Order Number:</strong> <span id="orderNumber">#ORD-123456</span></p>
      <p><strong>Total Amount:</strong> <span id="orderTotal">R0.00</span></p>
      <p><strong>Estimated Delivery:</strong> <span id="deliveryDate">5-7 working days</span></p>
      <p><strong>Payment Method:</strong> <span id="orderPayment">Credit Card</span></p>
      <p><strong>Payment Status:</strong> <span style="color: #10b981;">‚úÖ Paid</span></p>
    </div>
    
    <div class="modal-actions">
      <button class="modal-btn btn-secondary" onclick="continueShopping()">Continue Shopping</button>
      <button class="modal-btn btn-primary" onclick="trackOrder()">Track Order</button>
    </div>
  </div>
</div>

<script>
  // Order data
  let orderData = {
    items: JSON.parse(localStorage.getItem('cart')) || [
      { name: "Power Bank 20000mAh", price: 699, quantity: 1, image: "https://www.geewiz.co.za/247298-large_default/philips-2-port-20000mah-power-bank.jpg" },
      { name: "Gaming Mouse", price: 499, quantity: 2, image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSX3YvNGeMRX9_7-ohSXJP_NvsHffPhRocMOg&s" }
    ],
    summary: JSON.parse(localStorage.getItem('orderSummary')) || {
      subtotal: 1697,
      shipping: 99,
      discount: 169.7,
      total: 1626.3
    },
    customerInfo: JSON.parse(localStorage.getItem('customerInfo')) || {
      firstName: "John",
      lastName: "Doe",
      address: "123 Main Street",
      city: "Cape Town",
      province: "WC",
      postalCode: "8001",
      phone: "+27 12 345 6789",
      email: "customer@example.com"
    },
    deliveryOption: localStorage.getItem('deliveryOption') || 'standard'
  };

  let orderNumber = generateOrderNumber();

  // Initialize page
  document.addEventListener('DOMContentLoaded', () => {
    renderOrderItems();
    updateTotals();
    renderDeliveryInfo();
    setupEventListeners();
    
    // Set bank reference
    document.getElementById('bankReference').textContent = orderNumber;
  });

  // Render order items
  function renderOrderItems() {
    const orderItems = document.getElementById('orderItems');
    orderItems.innerHTML = '';
    
    orderData.items.forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'order-item';
      itemElement.innerHTML = `
        <div class="order-item-image">
          <img src="${item.image}" alt="${item.name}">
        </div>
        <div class="order-item-details">
          <div class="order-item-name">${item.name}</div>
          <div class="order-item-price">R${item.price.toFixed(2)}</div>
          <div class="order-item-quantity">Qty: ${item.quantity}</div>
        </div>
      `;
      orderItems.appendChild(itemElement);
    });
  }

  // Update totals
  function updateTotals() {
    const summary = orderData.summary;
    
    document.getElementById('subtotal').textContent = `R${summary.subtotal.toFixed(2)}`;
    document.getElementById('shipping').textContent = `R${summary.shipping.toFixed(2)}`;
    document.getElementById('discount').textContent = `-R${summary.discount.toFixed(2)}`;
    document.getElementById('total').textContent = `R${summary.total.toFixed(2)}`;
    document.getElementById('orderTotal').textContent = `R${summary.total.toFixed(2)}`;
  }

  // Render delivery information
  function renderDeliveryInfo() {
    const deliveryDetails = document.getElementById('deliveryDetails');
    const customer = orderData.customerInfo;
    const provinceNames = {
      'EC': 'Eastern Cape',
      'FS': 'Free State',
      'GP': 'Gauteng',
      'KZN': 'KwaZulu-Natal',
      'LP': 'Limpopo',
      'MP': 'Mpumalanga',
      'NC': 'Northern Cape',
      'NW': 'North West',
      'WC': 'Western Cape'
    };
    
    const deliveryMethod = {
      'standard': { name: 'Standard Delivery', days: '5-7 working days' },
      'express': { name: 'Express Delivery', days: '2-3 working days' },
      'pickup': { name: 'Store Pickup', days: 'Ready in 24 hours' }
    }[orderData.deliveryOption] || { name: 'Standard Delivery', days: '5-7 working days' };
    
    document.getElementById('deliveryDate').textContent = deliveryMethod.days;
    
    deliveryDetails.innerHTML = `
      <p><strong>Name:</strong> ${customer.firstName} ${customer.lastName}</p>
      <p><strong>Address:</strong> ${customer.address}, ${customer.city}</p>
      <p><strong>Province:</strong> ${provinceNames[customer.province] || customer.province}</p>
      <p><strong>Postal Code:</strong> ${customer.postalCode}</p>
      <p><strong>Phone:</strong> ${customer.phone}</p>
      <p><strong>Email:</strong> ${customer.email}</p>
      <p><strong>Delivery Method:</strong> ${deliveryMethod.name}</p>
    `;
  }

  // Setup event listeners
  function setupEventListeners() {
    // Payment method selection
    const paymentMethods = document.querySelectorAll('.payment-method');
    const cardDetails = document.getElementById('cardDetails');
    const bankDetails = document.getElementById('bankDetails');
    
    paymentMethods.forEach(method => {
      method.addEventListener('click', () => {
        paymentMethods.forEach(m => m.classList.remove('selected'));
        method.classList.add('selected');
        
        const paymentType = method.querySelector('input').value;
        
        // Show/hide relevant sections
        if (paymentType === 'card') {
          cardDetails.style.display = 'block';
          bankDetails.style.display = 'none';
        } else if (paymentType === 'eft') {
          cardDetails.style.display = 'none';
          bankDetails.style.display = 'block';
        } else {
          cardDetails.style.display = 'none';
          bankDetails.style.display = 'none';
        }
      });
    });

    // Form validation
    const cardInputs = document.querySelectorAll('#cardDetails input');
    cardInputs.forEach(input => {
      input.addEventListener('blur', validateField);
      input.addEventListener('input', clearError);
      
      // Formatting
      if (input.id === 'cardNumber') {
        input.addEventListener('input', formatCardNumber);
      } else if (input.id === 'expiry') {
        input.addEventListener('input', formatExpiryDate);
      } else if (input.id === 'cvv') {
        input.addEventListener('input', formatCVV);
      }
    });
  }

  // Format card number
  function formatCardNumber(e) {
    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
    let formatted = '';
    
    for (let i = 0; i < value.length; i++) {
      if (i > 0 && i % 4 === 0) {
        formatted += ' ';
      }
      formatted += value[i];
    }
    
    e.target.value = formatted.substring(0, 19);
  }

  // Format expiry date
  function formatExpiryDate(e) {
    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
    
    if (value.length >= 2) {
      e.target.value = value.substring(0, 2) + '/' + value.substring(2, 4);
    } else {
      e.target.value = value;
    }
  }

  // Format CVV
  function formatCVV(e) {
    let value = e.target.value.replace(/[^0-9]/gi, '');
    e.target.value = value.substring(0, 3);
  }

  // Validate field
  function validateField(e) {
    const field = e.target;
    const value = field.value.trim();
    const formGroup = field.closest('.form-group');
    
    if (!formGroup) return;
    
    let isValid = true;
    let errorMessage = '';
    
    // Clear previous error
    formGroup.classList.remove('has-error');
    
    // Check if field is empty
    if (!value) {
      isValid = false;
      errorMessage = 'This field is required';
    } else {
      // Specific validations
      switch (field.id) {
        case 'cardNumber':
          if (value.replace(/\s/g, '').length < 16) {
            isValid = false;
            errorMessage = 'Please enter a valid card number';
          }
          break;
          
        case 'expiry':
          if (!/^\d{2}\/\d{2}$/.test(value)) {
            isValid = false;
            errorMessage = 'Please enter expiry in MM/YY format';
          }
          break;
          
        case 'cvv':
          if (value.length !== 3 || !/^\d+$/.test(value)) {
            isValid = false;
            errorMessage = 'Please enter a valid CVV';
          }
          break;
      }
    }
    
    if (!isValid) {
      formGroup.classList.add('has-error');
      const errorElement = formGroup.querySelector('.error-message');
      if (errorElement) {
        errorElement.textContent = errorMessage;
      }
    }
    
    return isValid;
  }

  // Clear error
  function clearError(e) {
    const formGroup = e.target.closest('.form-group');
    if (formGroup) {
      formGroup.classList.remove('has-error');
    }
  }

  // Copy to clipboard
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'Copied!';
      btn.classList.add('copied');
      
      setTimeout(() => {
        btn.textContent = originalText;
        btn.classList.remove('copied');
      }, 2000);
    }).catch(err => {
      console.error('Failed to copy: ', err);
      alert('Failed to copy to clipboard');
    });
  }

  // Validate card details
  function validateCardDetails() {
    const paymentType = document.querySelector('input[name="payment"]:checked').value;
    
    if (paymentType === 'card') {
      const requiredFields = ['cardNumber', 'cardName', 'expiry', 'cvv'];
      let isValid = true;
      
      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!validateField({ target: field })) {
          isValid = false;
        }
      });
      
      return isValid;
    }
    
    return true; // For other payment methods, no card validation needed
  }

  // Validate terms checkbox
  function validateTerms() {
    const termsCheckbox = document.getElementById('terms');
    const termsError = document.getElementById('termsError');
    
    if (!termsCheckbox.checked) {
      termsError.style.display = 'block';
      return false;
    }
    
    termsError.style.display = 'none';
    return true;
  }

  // Process payment
  function processPayment() {
    // Validate form
    if (!validateCardDetails() || !validateTerms()) {
      alert('Please fill in all required fields correctly.');
      return;
    }
    
    // Show loading state
    const btnText = document.getElementById('btnText');
    const btnLoading = document.getElementById('btnLoading');
    const payButton = document.getElementById('payButton');
    
    btnText.textContent = 'Processing...';
    btnLoading.style.display = 'inline-block';
    payButton.disabled = true;
    
    // Get payment method
    const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
    const paymentLabels = {
      'card': 'Credit Card',
      'payfast': 'PayFast',
      'eft': 'Bank Transfer',
      'cash': 'Cash on Delivery'
    };
    
    // Update order details
    document.getElementById('orderNumber').textContent = orderNumber;
    document.getElementById('orderPayment').textContent = paymentLabels[paymentMethod];
    
    // Simulate API call delay
    setTimeout(() => {
      // Show success modal
      document.getElementById('successModal').classList.add('active');
      document.body.classList.add('modal-open');
      
      // Reset button state
      btnText.textContent = 'Complete Payment';
      btnLoading.style.display = 'none';
      payButton.disabled = false;
      
      // Clear cart (in a real app, this would be after successful payment)
      localStorage.removeItem('cart');
      localStorage.removeItem('orderSummary');
      localStorage.removeItem('customerInfo');
      localStorage.removeItem('deliveryOption');
      
      // Save order to localStorage for order history
      saveOrderHistory();
    }, 2000);
  }

  // Save order to history
  function saveOrderHistory() {
    const orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
    const order = {
      id: orderNumber,
      date: new Date().toISOString(),
      items: orderData.items,
      total: orderData.summary.total,
      status: 'Processing',
      paymentMethod: document.querySelector('input[name="payment"]:checked').value
    };
    
    orderHistory.unshift(order);
    localStorage.setItem('orderHistory', JSON.stringify(orderHistory.slice(0, 10))); // Keep last 10 orders
  }

  // Generate order number
  function generateOrderNumber() {
    const timestamp = Date.now().toString().slice(-6);
    const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
    return `#ORD-${timestamp}${random}`;
  }

  // Navigation functions
  function goToInformation() {
    window.location.href = 'information.html';
  }

  function continueShopping() {
    window.location.href = 'index.html';
  }

  function trackOrder() {
    alert(`Track your order using order number: ${orderNumber}`);
    window.location.href = 'index.html';
  }

  // Close modal on ESC key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      document.getElementById('successModal').classList.remove('active');
      document.body.classList.remove('modal-open');
    }
  });

  // Close modal when clicking outside
  document.getElementById('successModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('successModal')) {
      document.getElementById('successModal').classList.remove('active');
      document.body.classList.remove('modal-open');
    }
  });

  // Show notification
  function showNotification(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    `;
    
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }, 2000);
  }
</script>

</body>
</html>